L.Layer.Highlight=L.Layer.extend({_data:void 0,_initOpt:{},_otherOpt:void 0,_searchOpt:void 0,onAdd:function(t){let e=L.geoJSON(this._data,this._otherOpt);void 0!==this._otherOpt.eventHandlers&&Object.keys(this._otherOpt.eventHandlers).forEach(t=>{e.on(t,this._otherOpt.eventHandlers[t])}),e.addTo(t)},initialize:function(t){t&&t.email&&(this._initOpt.email=t.email)},do:function(t,e={}){return this._handleOpts(t,e),this._data=this._getHighlightData({street:t.street,city:t.city,q:t.q}),this},_getHighlightData:function(t){let e=this._getBatch(t),i=0;if(this._searchOpt.limit>1)for(;this._filter(e).features.length%this._searchOpt.limit==0&&(t.exclude=e.features.map(t=>t.properties.place_id),e.features=e.features.concat(this._getBatch(t).features),!(++i>10)););return this._cleanup(e,t)},_getBatch:function(t){let e=void 0;var i=new XMLHttpRequest;return i.open("GET","https://nominatim.openstreetmap.org/search?"+this._encodeQueryData(t),!1),i.setRequestHeader("Accept","application/json"),i.send(),200==i.status?e=JSON.parse(i.responseText):console.error(i),e},_handleOpts:function(t,e){if(!t||!t.q&&!t.city&&!t.street)throw Error("Empty search in L.Highlight constructor.");null!=t.filter&&null!=t.filter||(t.filter="LineString"),null!=t.limit&&null!=t.limit||(t.limit=50),e.style||(e.style=function(t){return{color:"#0040ff",opacity:1}}),this._searchOpt=t,this._otherOpt=e},_cleanup:function(t){return this._searchOpt.filter&&(t.features=t.features.filter(t=>t.geometry.type==this._searchOpt.filter)),t=this._filter(t)},_filter:function(t){return this._searchOpt.city&&(t.features=t.features.filter(t=>t.properties.address.city==this._searchOpt.city||t.properties.address.town==this._searchOpt.city)),this._searchOpt.street&&(t.features=t.features.filter(t=>t.properties.address.road==this._searchOpt.street)),t},_encodeQueryData:function(t){let e=[],i={q:t.q?t.q:"",street:t.q?"":t.street,city:t.q?"":t.city,exclude_place_ids:t.exclude?t.exclude.join(","):"",format:"geojson",polygon_geojson:1,dedupe:0,limit:this._searchOpt.limit,addressdetails:1,polygon_geojson:1,email:this._initOpt.email?this._initOpt.email:""};for(let t in i)e.push(encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e.join("&")}});